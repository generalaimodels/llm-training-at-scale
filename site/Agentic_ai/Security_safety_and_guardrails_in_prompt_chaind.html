<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="1.14 Security, Safety, and Guardrails in Prompt Chains">
  <title>1.14 Security, Safety, and Guardrails in Prompt Chains | AI Engineering Knowledge Hub</title>
  <script>
  (() => {
    try {
      const key = "docs-theme-mode";
      const raw = window.localStorage.getItem(key);
      const mode = raw === "graphite" || raw === "ivory" ? raw : "ivory";
      document.documentElement.dataset.theme = mode;
      document.documentElement.style.colorScheme = mode === "graphite" ? "dark" : "light";
    } catch {
      document.documentElement.dataset.theme = "ivory";
      document.documentElement.style.colorScheme = "light";
    }
  })();
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="../assets/vendor/katex/katex.min.css?v=2026-02-19T19%3A13%3A56.962Z">
  <link rel="stylesheet" href="../assets/styles.css?v=2026-02-19T19%3A13%3A56.962Z">
</head>
<body>
  <div class="ambient-layer ambient-layer-a" aria-hidden="true"></div>
  <div class="ambient-layer ambient-layer-b" aria-hidden="true"></div>
  <header class="topbar">
    <button id="menu-toggle" class="icon-btn" type="button" aria-label="Toggle navigation">Menu</button>
    <a class="brand" href="../index.html">
      <span class="brand-kicker">Docs</span>
      <strong>AI Engineering Knowledge Hub</strong>
    </a>
    <div class="topbar-actions">
      <input id="nav-filter" class="doc-filter" type="search" placeholder="Filter documents" aria-label="Filter documents">
      <p id="filter-status" class="filter-status" aria-live="polite"></p>
      <button id="theme-toggle" class="icon-btn" type="button" aria-label="Switch theme">Graphite</button>
    </div>
  </header>
  <div class="site-shell">
    <aside class="nav-pane" id="left-nav">
      <p class="pane-label">Source Folder</p>
      <p class="pane-title">llm_training_at_scale</p>
      <nav class="doc-nav" aria-label="Document list">
<a class="doc-link" data-doc-link data-doc-title="1.10 advanced prompt chaining techniques" data-doc-path="agentic_ai/advanced_prompt_chaining_techniques" data-doc-folder="agentic_ai" href="../Agentic_ai/Advanced_prompt_chaining_techniques.html"><span>1.10 Advanced Prompt Chaining Techniques</span><small>Agentic_ai/Advanced_prompt_chaining_techniques</small></a>
<a class="doc-link" data-doc-link data-doc-title="chapter 1: prompt chaining" data-doc-path="agentic_ai/architecture_and_design_patterns_of_prompt_chains" data-doc-folder="agentic_ai" href="../Agentic_ai/Architecture_and_design_patterns_of_prompt_chains.html"><span>Chapter 1: Prompt Chaining</span><small>Agentic_ai/Architecture_and_design_patterns_of_prompt_chains</small></a>
<a class="doc-link" data-doc-link data-doc-title="1.7 error handling, robustness, and fault tolerance" data-doc-path="agentic_ai/error_handling_robustness_and_fault_tolerance" data-doc-folder="agentic_ai" href="../Agentic_ai/Error_handling_robustness_and_fault_tolerance.html"><span>1.7 Error Handling, Robustness, and Fault Tolerance</span><small>Agentic_ai/Error_handling_robustness_and_fault_tolerance</small></a>
<a class="doc-link" data-doc-link data-doc-title="1.13 evaluation of prompt chains" data-doc-path="agentic_ai/evaluation_of_prompt_chains" data-doc-folder="agentic_ai" href="../Agentic_ai/Evaluation_of_prompt_chains.html"><span>1.13 Evaluation of Prompt Chains</span><small>Agentic_ai/Evaluation_of_prompt_chains</small></a>
<a class="doc-link" data-doc-link data-doc-title="chapter 1: prompt chaining — comprehensive treatment" data-doc-path="agentic_ai/foundations_of_prompt_chaining" data-doc-folder="agentic_ai" href="../Agentic_ai/Foundations_of_prompt_chaining.html"><span>Chapter 1: Prompt Chaining — Comprehensive Treatment</span><small>Agentic_ai/Foundations_of_prompt_chaining</small></a>
<a class="doc-link" data-doc-link data-doc-title="1.9 optimization of prompt chains" data-doc-path="agentic_ai/optimization_of_prompt_chains" data-doc-folder="agentic_ai" href="../Agentic_ai/Optimization_of_prompt_chains.html"><span>1.9 Optimization of Prompt Chains</span><small>Agentic_ai/Optimization_of_prompt_chains</small></a>
<a class="doc-link" data-doc-link data-doc-title="prompt chaining: frameworks, observability, evaluation, security, applications, and paradigm comparisons" data-doc-path="agentic_ai/prompt chaining_frameworks_and_implementation" data-doc-folder="agentic_ai" href="../Agentic_ai/Prompt Chaining_frameworks_and_Implementation.html"><span>Prompt Chaining: Frameworks, Observability, Evaluation, Security, Applications, and Paradigm Comparisons</span><small>Agentic_ai/Prompt Chaining_frameworks_and_Implementation</small></a>
<a class="doc-link" data-doc-link data-doc-title="chapter 1: prompt chaining — comprehensive index" data-doc-path="agentic_ai/prompt_chaining_index" data-doc-folder="agentic_ai" href="../Agentic_ai/Prompt_Chaining_index.html"><span>Chapter 1: Prompt Chaining — Comprehensive Index</span><small>Agentic_ai/Prompt_Chaining_index</small></a>
<a class="doc-link" data-doc-link data-doc-title="1.16 prompt chaining vs. related paradigms" data-doc-path="agentic_ai/prompt_chaining_vs_related_paradigm" data-doc-folder="agentic_ai" href="../Agentic_ai/Prompt_chaining_vs_related_paradigm.html"><span>1.16 Prompt Chaining vs. Related Paradigms</span><small>Agentic_ai/Prompt_chaining_vs_related_paradigm</small></a>
<a class="doc-link" data-doc-link data-doc-title="chapter 1: prompt chaining" data-doc-path="agentic_ai/prompt_design_for_chain_steps" data-doc-folder="agentic_ai" href="../Agentic_ai/Prompt_design_for_chain_steps.html"><span>Chapter 1: Prompt Chaining</span><small>Agentic_ai/Prompt_design_for_chain_steps</small></a>
<a class="doc-link" data-doc-link data-doc-title="1.15 real-world applications and case studies" data-doc-path="agentic_ai/real-world_applications_and_case_studies" data-doc-folder="agentic_ai" href="../Agentic_ai/Real-World_applications_and_case_studies.html"><span>1.15 Real-World Applications and Case Studies</span><small>Agentic_ai/Real-World_applications_and_case_studies</small></a>
<a class="doc-link" data-doc-link data-doc-title="1.6 routing and conditional logic in chains" data-doc-path="agentic_ai/routing_and_conditional_logic_in_chains" data-doc-folder="agentic_ai" href="../Agentic_ai/Routing_and_conditional_logic_in_chains.html"><span>1.6 Routing and Conditional Logic in Chains</span><small>Agentic_ai/Routing_and_conditional_logic_in_chains</small></a>
<a class="doc-link is-active" data-doc-link data-doc-title="1.14 security, safety, and guardrails in prompt chains" data-doc-path="agentic_ai/security_safety_and_guardrails_in_prompt_chaind" data-doc-folder="agentic_ai" href="../Agentic_ai/Security_safety_and_guardrails_in_prompt_chaind.html"><span>1.14 Security, Safety, and Guardrails in Prompt Chains</span><small>Agentic_ai/Security_safety_and_guardrails_in_prompt_chaind</small></a>
<a class="doc-link" data-doc-link data-doc-title="1.4 state management and context propagation" data-doc-path="agentic_ai/state_management_and_context_propagation" data-doc-folder="agentic_ai" href="../Agentic_ai/State_management_and_context_propagation.html"><span>1.4 State Management and Context Propagation</span><small>Agentic_ai/State_management_and_context_propagation</small></a>
<a class="doc-link" data-doc-link data-doc-title="1.5 task decomposition strategies" data-doc-path="agentic_ai/task_decomposition_strategies" data-doc-folder="agentic_ai" href="../Agentic_ai/Task_decomposition_strategies.html"><span>1.5 Task Decomposition Strategies</span><small>Agentic_ai/Task_decomposition_strategies</small></a>
<a class="doc-link" data-doc-link data-doc-title="chapter 2: tools — comprehensive sota reference" data-doc-path="agentic_ai/tools/documentation_mcp_mcp_for_agent_security" data-doc-folder="agentic_ai/tools" href="../Agentic_ai/Tools/Documentation_MCP_mcp_for_agent_security.html"><span>Chapter 2: Tools — Comprehensive SOTA Reference</span><small>Agentic_ai/Tools/Documentation_MCP_mcp_for_agent_security</small></a>
<a class="doc-link" data-doc-link data-doc-title="chapter 2: tools — comprehensive sota reference" data-doc-path="agentic_ai/tools/introduction_tools_action" data-doc-folder="agentic_ai/tools" href="../Agentic_ai/Tools/Introduction_Tools_Action.html"><span>Chapter 2: Tools — Comprehensive SOTA Reference</span><small>Agentic_ai/Tools/Introduction_Tools_Action</small></a>
<a class="doc-link" data-doc-link data-doc-title="2.6 security in mcp" data-doc-path="agentic_ai/tools/security_mcp_conclusion" data-doc-folder="agentic_ai/tools" href="../Agentic_ai/Tools/Security_MCP_conclusion.html"><span>2.6 Security in MCP</span><small>Agentic_ai/Tools/Security_MCP_conclusion</small></a>
<a class="doc-link" data-doc-link data-doc-title="chapter 2: tools — comprehensive sota index" data-doc-path="agentic_ai/tools/tools_comprehensive_index" data-doc-folder="agentic_ai/tools" href="../Agentic_ai/Tools/Tools_comprehensive_Index.html"><span>Chapter 2: Tools — Comprehensive SOTA Index</span><small>Agentic_ai/Tools/Tools_comprehensive_Index</small></a>
<a class="doc-link" data-doc-link data-doc-title="1.8 verification, validation, and quality control" data-doc-path="agentic_ai/verification_validation_and_quality_control" data-doc-folder="agentic_ai" href="../Agentic_ai/Verification_validation_and_quality_control.html"><span>1.8 Verification, Validation, and Quality Control</span><small>Agentic_ai/Verification_validation_and_quality_control</small></a>
<a class="doc-link" data-doc-link data-doc-title="context parallelism and ring attention" data-doc-path="context_parallelism_update" data-doc-folder="root" href="../context_parallelism_update.html"><span>Context Parallelism and Ring Attention</span><small>context_parallelism_update</small></a>
<a class="doc-link" data-doc-link data-doc-title="tensor parallelism (tp) and sequence parallelism (sp)" data-doc-path="context_parallelism" data-doc-folder="root" href="../context_parallelism.html"><span>Tensor Parallelism (TP) and Sequence Parallelism (SP)</span><small>context_parallelism</small></a>
<a class="doc-link" data-doc-link data-doc-title="data parallelism: a comprehensive technical treatment" data-doc-path="data_parallelism_basic" data-doc-folder="root" href="../data_parallelism_basic.html"><span>Data Parallelism: A Comprehensive Technical Treatment</span><small>data_parallelism_basic</small></a>
<a class="doc-link" data-doc-link data-doc-title="data parallelism (dp): a comprehensive technical treatment" data-doc-path="data_parallelism" data-doc-folder="root" href="../data_parallelism.html"><span>Data Parallelism (DP): A Comprehensive Technical Treatment</span><small>data_parallelism</small></a>
<a class="doc-link" data-doc-link data-doc-title="finding the best training configuration for distributed large model training" data-doc-path="distributed_large_model_training" data-doc-folder="root" href="../distributed_large_model_training.html"><span>Finding the Best Training Configuration for Distributed Large Model Training</span><small>distributed_large_model_training</small></a>
<a class="doc-link" data-doc-link data-doc-title="diving into the gpus — fusing, threading, and mixing" data-doc-path="diving_gpus_fusing_threading_and_mixing" data-doc-folder="root" href="../diving_gpus_fusing_threading_and_mixing.html"><span>Diving into the GPUs — Fusing, Threading, and Mixing</span><small>diving_gpus_fusing_threading_and_mixing</small></a>
<a class="doc-link" data-doc-link data-doc-title="expert parallelism and 5d parallelism: a comprehensive technical treatment" data-doc-path="expert_parallelism_update" data-doc-folder="root" href="../expert_parallelism_update.html"><span>Expert Parallelism and 5D Parallelism: A Comprehensive Technical Treatment</span><small>expert_parallelism_update</small></a>
<a class="doc-link" data-doc-link data-doc-title="expert parallelism and 5d parallelism: a comprehensive technical treatment" data-doc-path="expert_parallelism" data-doc-folder="root" href="../expert_parallelism.html"><span>Expert Parallelism and 5D Parallelism: A Comprehensive Technical Treatment</span><small>expert_parallelism</small></a>
<a class="doc-link" data-doc-link data-doc-title="scaling distributed training: foundations and first principles" data-doc-path="high_level_overview_updated" data-doc-folder="root" href="../high_level_overview_updated.html"><span>Scaling Distributed Training: Foundations and First Principles</span><small>high_level_overview_updated</small></a>
<a class="doc-link" data-doc-link data-doc-title="high-level overview of distributed training: foundations, memory analysis, and first-step techniques" data-doc-path="high_level_overview" data-doc-folder="root" href="../high_level_overview.html"><span>High-Level Overview of Distributed Training: Foundations, Memory Analysis, and First-Step Techniques</span><small>high_level_overview</small></a>
<a class="doc-link" data-doc-link data-doc-title="pipeline parallelism: comprehensive technical exposition" data-doc-path="pipelineparallelism_update" data-doc-folder="root" href="../pipelineparallelism_update.html"><span>Pipeline Parallelism: Comprehensive Technical Exposition</span><small>pipelineparallelism_update</small></a>
<a class="doc-link" data-doc-link data-doc-title="pipeline parallelism: a comprehensive technical exposition" data-doc-path="pipelineparallelism" data-doc-folder="root" href="../pipelineparallelism.html"><span>Pipeline Parallelism: A Comprehensive Technical Exposition</span><small>pipelineparallelism</small></a>
<a class="doc-link" data-doc-link data-doc-title="tensor parallelism (tp) and sequence parallelism (sp)" data-doc-path="tensor_parallelism_update" data-doc-folder="root" href="../tensor_parallelism_update.html"><span>Tensor Parallelism (TP) and Sequence Parallelism (SP)</span><small>tensor_parallelism_update</small></a>
<a class="doc-link" data-doc-link data-doc-title="tensor parallelism (tp) and sequence parallelism (sp)" data-doc-path="tensor_parallelism" data-doc-folder="root" href="../tensor_parallelism.html"><span>Tensor Parallelism (TP) and Sequence Parallelism (SP)</span><small>tensor_parallelism</small></a>
      </nav>
    </aside>
    <main class="content-pane">
      <article class="doc-content">
<h2 id="114-security-safety-and-guardrails-in-prompt-chains" tabindex="-1">1.14 Security, Safety, and Guardrails in Prompt Chains</h2>
<h3 id="1141-threat-model-for-prompt-chains" tabindex="-1">1.14.1 Threat Model for Prompt Chains</h3>
<p>Prompt chains <strong>expand the attack surface</strong> compared to single-prompt systems. Each step is a potential injection point, and inter-step data flow creates <strong>transitive trust violations</strong> where untrusted data from one step propagates as trusted input to subsequent steps.</p>
<h4 id="attack-surface-analysis" tabindex="-1">Attack Surface Analysis</h4>
<div class="code-shell"><pre class="hljs"><code class="hljs">                    Attack Surface Map
┌─────────────────────────────────────────────────────────┐
│                                                         │
│  User Input ──▶ [Step 1] ──▶ [Step 2] ──▶ [Step 3]    │
│       ▲              │            │            │        │
│       │              ▼            ▼            ▼        │
│  ①Injection    ②Output        ③Retrieved   ④Tool       │
│   at entry      carries        content      execution   │
│                 payload        injection    hijacking    │
│                                                         │
│  Attack Vectors:                                        │
│  ① Direct prompt injection via user input               │
│  ② Poisoned output from Step 1 manipulates Step 2      │
│  ③ Adversarial content in retrieved documents           │
│  ④ Malicious tool calls or code execution               │
│  ⑤ Data exfiltration via output channels                │
│  ⑥ Chain flow hijacking via conditional manipulation    │
└─────────────────────────────────────────────────────────┘
</code></pre>
</div><h4 id="formal-threat-taxonomy" tabindex="-1">Formal Threat Taxonomy</h4>
<p><strong>1. Direct Prompt Injection</strong>: Adversary crafts <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mtext>adv</mtext></msub></mrow><annotation encoding="application/x-tex">x_{\text{adv}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">adv</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq> such that:</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="script">C</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mtext>adv</mtext></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>y</mi><mtext>attacker-desired</mtext></msub><mo mathvariant="normal">≠</mo><msub><mi>y</mi><mtext>intended</mtext></msub></mrow><annotation encoding="application/x-tex">
\mathcal{C}(x_{\text{adv}}) = y_{\text{attacker-desired}} \neq y_{\text{intended}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal" style="margin-right:0.05834em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">adv</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">attacker-desired</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">intended</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></eqn></section><p>The injection payload is embedded in the user-controlled input at step 1.</p>
<p><strong>2. Indirect Prompt Injection (via retrieved content)</strong>:</p>
<p>In RAG chains, the retrieval step fetches document <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span></eq>from an external corpus. An adversary poisons<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span></eq> such that:</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>Step</mtext><mi>k</mi></msub><mo stretchy="false">(</mo><msub><mtext>prompt</mtext><mi>k</mi></msub><mo>⊕</mo><msub><mi>d</mi><mtext>poisoned</mtext></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>y</mi><mtext>malicious</mtext></msub></mrow><annotation encoding="application/x-tex">
\text{Step}_k(\text{prompt}_k \oplus d_{\text{poisoned}}) = y_{\text{malicious}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord">Step</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.242em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord">prompt</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.242em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">poisoned</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">malicious</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></eqn></section><p>The chain trusts retrieved content as factual context, but the content contains adversarial instructions.</p>
<p><strong>3. Transitive Injection (Cross-Step Propagation)</strong>:</p>
<p>Output from step <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></eq>contains an injection payload that activates at step<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>&gt;</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">j &gt; i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></eq>:</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mtext>legitimate content</mtext><mo>⊕</mo><mtext>latent payload</mtext></mrow><annotation encoding="application/x-tex">
y_i = s_i(x_i) = \text{legitimate content} \oplus \text{latent payload}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">legitimate content</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">latent payload</span></span></span></span></span></span></eqn></section><section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>=</mo><msub><mi>s</mi><mi>j</mi></msub><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mtext>payload-manipulated output</mtext></mrow><annotation encoding="application/x-tex">
y_j = s_j(y_i) = \text{payload-manipulated output}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">payload-manipulated output</span></span></span></span></span></span></eqn></section><p>This is particularly dangerous because <strong>intermediate outputs are typically not user-visible</strong>.</p>
<p><strong>4. Data Exfiltration</strong>:</p>
<p>An adversary causes the chain to encode sensitive information (from system prompts, retrieved documents, or previous conversation) into the output:</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">∃</mi><msub><mi>f</mi><mtext>decode</mtext></msub><mo>:</mo><msub><mi>f</mi><mtext>decode</mtext></msub><mo stretchy="false">(</mo><mi mathvariant="script">C</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mtext>adv</mtext></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mtext>sensitive data</mtext></mrow><annotation encoding="application/x-tex">
\exists f_{\text{decode}} : f_{\text{decode}}(\mathcal{C}(x_{\text{adv}})) = \text{sensitive data}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">∃</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">decode</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">decode</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathcal" style="margin-right:0.05834em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">adv</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord">sensitive data</span></span></span></span></span></span></eqn></section><p><strong>5. Chain Hijacking</strong>:</p>
<p>Manipulate conditional branching logic by crafting inputs that force the chain into an unintended execution path:</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mtext>adv</mtext></msub><mo stretchy="false">)</mo><mo>=</mo><mtext>true</mtext><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><mtext>execute expensive/dangerous branch</mtext></mrow><annotation encoding="application/x-tex">
p_i(x_{\text{adv}}) = \text{true} \implies \text{execute expensive/dangerous branch}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">adv</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6391em;vertical-align:-0.024em;"></span><span class="mord text"><span class="mord">true</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">execute expensive/dangerous branch</span></span></span></span></span></span></eqn></section><p><strong>6. Privilege Escalation</strong>:</p>
<p>Step <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></eq>has access to a tool (database, API) that earlier steps should not be able to invoke. By injecting instructions at step 1, the adversary causes step<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></eq> to execute unintended tool calls.</p>
<hr>
<h3 id="1142-defense-mechanisms" tabindex="-1">1.14.2 Defense Mechanisms</h3>
<h4 id="input-sanitization-per-chain-step" tabindex="-1">Input Sanitization Per Chain Step</h4>
<div class="code-shell"><pre class="hljs"><code class="hljs language-python"><span class="hljs-keyword">import</span> re
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">InputSanitizer</span>:
    <span class="hljs-string">&quot;&quot;&quot;Multi-layer input sanitization for chain steps.&quot;&quot;&quot;</span>
    
    INJECTION_PATTERNS = [
        <span class="hljs-string">r&quot;ignore\s+(all\s+)?(previous|above|prior)\s+(instructions|prompts)&quot;</span>,
        <span class="hljs-string">r&quot;you\s+are\s+now\s+&quot;</span>,
        <span class="hljs-string">r&quot;new\s+instructions?\s*:&quot;</span>,
        <span class="hljs-string">r&quot;system\s*:\s*&quot;</span>,
        <span class="hljs-string">r&quot;&lt;\s*/?\s*system\s*&gt;&quot;</span>,
        <span class="hljs-string">r&quot;```\s*(system|instruction)&quot;</span>,
        <span class="hljs-string">r&quot;IMPORTANT:\s*override&quot;</span>,
        <span class="hljs-string">r&quot;\[INST\]&quot;</span>,
        <span class="hljs-string">r&quot;&lt;&lt;SYS&gt;&gt;&quot;</span>,
    ]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, max_length: <span class="hljs-built_in">int</span> = <span class="hljs-number">10000</span>, 
                 allow_code: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span>):
        <span class="hljs-variable language_">self</span>.max_length = max_length
        <span class="hljs-variable language_">self</span>.allow_code = allow_code
        <span class="hljs-variable language_">self</span>.compiled_patterns = [
            re.<span class="hljs-built_in">compile</span>(p, re.IGNORECASE) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.INJECTION_PATTERNS
        ]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sanitize</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>]]:
        <span class="hljs-string">&quot;&quot;&quot;
        Returns (sanitized_text, list_of_warnings).
        &quot;&quot;&quot;</span>
        warnings = []
        
        <span class="hljs-comment"># 1. Length enforcement</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(text) &gt; <span class="hljs-variable language_">self</span>.max_length:
            text = text[:<span class="hljs-variable language_">self</span>.max_length]
            warnings.append(<span class="hljs-string">f&quot;Input truncated to <span class="hljs-subst">{self.max_length}</span> chars&quot;</span>)
        
        <span class="hljs-comment"># 2. Injection pattern detection</span>
        <span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.compiled_patterns:
            <span class="hljs-keyword">if</span> pattern.search(text):
                warnings.append(<span class="hljs-string">f&quot;Potential injection detected: <span class="hljs-subst">{pattern.pattern}</span>&quot;</span>)
                <span class="hljs-comment"># Replace rather than block — preserve benign content</span>
                text = pattern.sub(<span class="hljs-string">&quot;[FILTERED]&quot;</span>, text)
        
        <span class="hljs-comment"># 3. Control character removal</span>
        text = <span class="hljs-string">&#x27;&#x27;</span>.join(
            c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> text 
            <span class="hljs-keyword">if</span> c.isprintable() <span class="hljs-keyword">or</span> c <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;\n\t&#x27;</span>
        )
        
        <span class="hljs-comment"># 4. Code block handling</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.allow_code:
            text = re.sub(<span class="hljs-string">r&#x27;```[\s\S]*?```&#x27;</span>, <span class="hljs-string">&#x27;[CODE_BLOCK_REMOVED]&#x27;</span>, text)
        
        <span class="hljs-keyword">return</span> text, warnings
</code></pre>
</div><h4 id="guardrail-chain-pattern" tabindex="-1">Guardrail Chain Pattern</h4>
<p>Implement safety checks as <strong>dedicated chain steps</strong> rather than inline logic:</p>
<div class="code-shell"><pre class="hljs"><code class="hljs language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GuardrailChain</span>:
    <span class="hljs-string">&quot;&quot;&quot;Chain wrapper that adds pre/post safety checks.&quot;&quot;&quot;</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, core_chain, safety_classifier, 
                 content_policy, pii_detector</span>):
        <span class="hljs-variable language_">self</span>.core_chain = core_chain
        <span class="hljs-variable language_">self</span>.safety_classifier = safety_classifier
        <span class="hljs-variable language_">self</span>.content_policy = content_policy
        <span class="hljs-variable language_">self</span>.pii_detector = pii_detector
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-params">self, input_data: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
        <span class="hljs-comment"># ═══ PRE-CHAIN SAFETY ═══</span>
        
        <span class="hljs-comment"># 1. Input safety classification</span>
        safety_result = <span class="hljs-variable language_">self</span>.safety_classifier.classify(input_data[<span class="hljs-string">&quot;text&quot;</span>])
        <span class="hljs-keyword">if</span> safety_result[<span class="hljs-string">&quot;category&quot;</span>] <span class="hljs-keyword">in</span> (<span class="hljs-string">&quot;harmful&quot;</span>, <span class="hljs-string">&quot;illegal&quot;</span>, <span class="hljs-string">&quot;explicit&quot;</span>):
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">&quot;response&quot;</span>: <span class="hljs-string">&quot;I cannot process this request.&quot;</span>,
                <span class="hljs-string">&quot;blocked&quot;</span>: <span class="hljs-literal">True</span>,
                <span class="hljs-string">&quot;reason&quot;</span>: safety_result[<span class="hljs-string">&quot;category&quot;</span>],
                <span class="hljs-string">&quot;trace_id&quot;</span>: generate_trace_id()
            }
        
        <span class="hljs-comment"># 2. PII detection and redaction in input</span>
        redacted_input, pii_entities = <span class="hljs-variable language_">self</span>.pii_detector.redact(input_data[<span class="hljs-string">&quot;text&quot;</span>])
        input_data[<span class="hljs-string">&quot;text&quot;</span>] = redacted_input
        
        <span class="hljs-comment"># ═══ CORE CHAIN EXECUTION ═══</span>
        result = <span class="hljs-variable language_">self</span>.core_chain.invoke(input_data)
        
        <span class="hljs-comment"># ═══ POST-CHAIN SAFETY ═══</span>
        
        <span class="hljs-comment"># 3. Output content policy check</span>
        policy_result = <span class="hljs-variable language_">self</span>.content_policy.check(result[<span class="hljs-string">&quot;response&quot;</span>])
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> policy_result[<span class="hljs-string">&quot;passes&quot;</span>]:
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">&quot;response&quot;</span>: <span class="hljs-string">&quot;Response filtered due to content policy.&quot;</span>,
                <span class="hljs-string">&quot;blocked&quot;</span>: <span class="hljs-literal">True</span>,
                <span class="hljs-string">&quot;reason&quot;</span>: policy_result[<span class="hljs-string">&quot;violation&quot;</span>],
                <span class="hljs-string">&quot;trace_id&quot;</span>: result.get(<span class="hljs-string">&quot;trace_id&quot;</span>)
            }
        
        <span class="hljs-comment"># 4. Output PII detection (prevent leakage)</span>
        output_pii = <span class="hljs-variable language_">self</span>.pii_detector.detect(result[<span class="hljs-string">&quot;response&quot;</span>])
        <span class="hljs-keyword">if</span> output_pii:
            result[<span class="hljs-string">&quot;response&quot;</span>] = <span class="hljs-variable language_">self</span>.pii_detector.redact(result[<span class="hljs-string">&quot;response&quot;</span>])[<span class="hljs-number">0</span>]
            result[<span class="hljs-string">&quot;pii_redacted&quot;</span>] = <span class="hljs-literal">True</span>
        
        <span class="hljs-comment"># 5. Restore PII placeholders if needed</span>
        <span class="hljs-keyword">if</span> pii_entities:
            result[<span class="hljs-string">&quot;pii_detected_in_input&quot;</span>] = <span class="hljs-built_in">len</span>(pii_entities)
        
        <span class="hljs-keyword">return</span> result
</code></pre>
</div><h4 id="canary-token-injection-detection" tabindex="-1">Canary Token Injection Detection</h4>
<p>Insert <strong>canary tokens</strong> into system prompts to detect extraction attempts:</p>
<div class="code-shell"><pre class="hljs"><code class="hljs language-python"><span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CanaryTokenDetector</span>:
    <span class="hljs-string">&quot;&quot;&quot;Detect system prompt extraction via canary tokens.&quot;&quot;&quot;</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, secret_key: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-variable language_">self</span>.secret_key = secret_key
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_canary</span>(<span class="hljs-params">self, step_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">&quot;&quot;&quot;Generate a unique canary token for a chain step.&quot;&quot;&quot;</span>
        raw = <span class="hljs-string">f&quot;<span class="hljs-subst">{self.secret_key}</span>:<span class="hljs-subst">{step_id}</span>:<span class="hljs-subst">{<span class="hljs-built_in">int</span>(time.time() // <span class="hljs-number">3600</span>)}</span>&quot;</span>
        token = hashlib.sha256(raw.encode()).hexdigest()[:<span class="hljs-number">16</span>]
        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;INTERNAL_REF_<span class="hljs-subst">{token}</span>&quot;</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inject_canary</span>(<span class="hljs-params">self, system_prompt: <span class="hljs-built_in">str</span>, step_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">&quot;&quot;&quot;Inject canary into system prompt.&quot;&quot;&quot;</span>
        canary = <span class="hljs-variable language_">self</span>.generate_canary(step_id)
        <span class="hljs-comment"># Embed canary as a seemingly natural part of the prompt</span>
        injection = <span class="hljs-string">f&quot;\n[Internal reference ID: <span class="hljs-subst">{canary}</span>]\n&quot;</span>
        <span class="hljs-keyword">return</span> system_prompt + injection
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_output</span>(<span class="hljs-params">self, output: <span class="hljs-built_in">str</span>, step_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">&quot;&quot;&quot;Check if output contains the canary token (indicates leakage).&quot;&quot;&quot;</span>
        canary = <span class="hljs-variable language_">self</span>.generate_canary(step_id)
        <span class="hljs-keyword">return</span> canary <span class="hljs-keyword">in</span> output
</code></pre>
</div><h4 id="principle-of-least-privilege-per-chain-step" tabindex="-1">Principle of Least Privilege Per Chain Step</h4>
<div class="code-shell"><pre class="hljs"><code class="hljs language-python"><span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StepPermissions</span>:
    <span class="hljs-string">&quot;&quot;&quot;Fine-grained permissions for each chain step.&quot;&quot;&quot;</span>
    allowed_tools: <span class="hljs-built_in">set</span>[<span class="hljs-built_in">str</span>] = field(default_factory=<span class="hljs-built_in">set</span>)
    allowed_models: <span class="hljs-built_in">set</span>[<span class="hljs-built_in">str</span>] = field(default_factory=<span class="hljs-built_in">set</span>)
    max_tokens: <span class="hljs-built_in">int</span> = <span class="hljs-number">4096</span>
    can_access_internet: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>
    can_execute_code: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>
    can_read_filesystem: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>
    allowed_api_endpoints: <span class="hljs-built_in">set</span>[<span class="hljs-built_in">str</span>] = field(default_factory=<span class="hljs-built_in">set</span>)
    max_cost_usd: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.10</span>
    timeout_seconds: <span class="hljs-built_in">int</span> = <span class="hljs-number">30</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionEnforcer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, permissions: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, StepPermissions]</span>):
        <span class="hljs-variable language_">self</span>.permissions = permissions
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">self, step_id: <span class="hljs-built_in">str</span>, action: <span class="hljs-built_in">str</span>, resource: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        perms = <span class="hljs-variable language_">self</span>.permissions.get(step_id)
        <span class="hljs-keyword">if</span> perms <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>  <span class="hljs-comment"># Deny by default</span>
        
        <span class="hljs-keyword">if</span> action == <span class="hljs-string">&quot;call_tool&quot;</span>:
            <span class="hljs-keyword">return</span> resource <span class="hljs-keyword">in</span> perms.allowed_tools
        <span class="hljs-keyword">elif</span> action == <span class="hljs-string">&quot;call_model&quot;</span>:
            <span class="hljs-keyword">return</span> resource <span class="hljs-keyword">in</span> perms.allowed_models
        <span class="hljs-keyword">elif</span> action == <span class="hljs-string">&quot;execute_code&quot;</span>:
            <span class="hljs-keyword">return</span> perms.can_execute_code
        <span class="hljs-keyword">elif</span> action == <span class="hljs-string">&quot;access_url&quot;</span>:
            <span class="hljs-keyword">return</span> perms.can_access_internet
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>  <span class="hljs-comment"># Deny unknown actions</span>
</code></pre>
</div><hr>
<h3 id="1143-safety-patterns" tabindex="-1">1.14.3 Safety Patterns</h3>
<h4 id="architecture-defense-in-depth-for-chains" tabindex="-1">Architecture: Defense-in-Depth for Chains</h4>
<div class="code-shell"><pre class="hljs"><code class="hljs">User Input
    │
    ▼
┌──────────────────┐
│  Input Shield     │ ← Content classification, injection detection
└────────┬─────────┘
         │ (sanitized input)
         ▼
┌──────────────────┐
│  PII Redactor     │ ← Replace PII with placeholders
└────────┬─────────┘
         │
    ┌────▼────────────────────────────────────────┐
    │           CORE CHAIN (sandboxed)             │
    │  ┌────────┐    ┌────────┐    ┌────────┐     │
    │  │ Step 1 │───▶│ Step 2 │───▶│ Step 3 │     │
    │  └────────┘    └───┬────┘    └────────┘     │
    │                    │                         │
    │              ┌─────▼─────┐                   │
    │              │Checkpoint │ ← Mid-chain       │
    │              │  Safety   │   safety check    │
    │              └───────────┘                   │
    └────────────────────┬────────────────────────┘
                         │
                         ▼
                ┌──────────────────┐
                │  Output Shield    │ ← Content policy, PII leak check
                └────────┬─────────┘
                         │
                         ▼
                ┌──────────────────┐
                │  Audit Logger     │ ← Compliance logging
                └────────┬─────────┘
                         │
                         ▼
                    Final Output
</code></pre>
</div><h4 id="intermediate-safety-checkpoints" tabindex="-1">Intermediate Safety Checkpoints</h4>
<p>For long chains, insert safety verification <strong>between critical steps</strong>:</p>
<div class="code-shell"><pre class="hljs"><code class="hljs language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SafetyCheckpoint</span>:
    <span class="hljs-string">&quot;&quot;&quot;Mid-chain safety verification step.&quot;&quot;&quot;</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, safety_model, policies: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>]</span>):
        <span class="hljs-variable language_">self</span>.safety_model = safety_model
        <span class="hljs-variable language_">self</span>.policies = policies
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">self, intermediate_output: <span class="hljs-built_in">str</span>, chain_context: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
        <span class="hljs-string">&quot;&quot;&quot;
        Verify intermediate output before it becomes input to next step.
        &quot;&quot;&quot;</span>
        checks = {
            <span class="hljs-string">&quot;contains_harmful_instructions&quot;</span>: <span class="hljs-variable language_">self</span>._check_harmful(intermediate_output),
            <span class="hljs-string">&quot;contains_pii&quot;</span>: <span class="hljs-variable language_">self</span>._check_pii(intermediate_output),
            <span class="hljs-string">&quot;contains_injection_payload&quot;</span>: <span class="hljs-variable language_">self</span>._check_injection(intermediate_output),
            <span class="hljs-string">&quot;within_scope&quot;</span>: <span class="hljs-variable language_">self</span>._check_scope(intermediate_output, chain_context),
        }
        
        passed = <span class="hljs-built_in">all</span>(<span class="hljs-keyword">not</span> v <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> checks.values())
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> passed:
            failed_checks = [k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> checks.items() <span class="hljs-keyword">if</span> v]
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">&quot;passed&quot;</span>: <span class="hljs-literal">False</span>,
                <span class="hljs-string">&quot;failed_checks&quot;</span>: failed_checks,
                <span class="hljs-string">&quot;action&quot;</span>: <span class="hljs-string">&quot;halt_chain&quot;</span>,
                <span class="hljs-string">&quot;sanitized_output&quot;</span>: <span class="hljs-variable language_">self</span>._sanitize(intermediate_output, failed_checks)
            }
        
        <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;passed&quot;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&quot;action&quot;</span>: <span class="hljs-string">&quot;continue&quot;</span>}
</code></pre>
</div><hr>
<h3 id="1144-access-control-and-governance" tabindex="-1">1.14.4 Access Control and Governance</h3>
<h4 id="role-based-access-control-rbac-for-chains" tabindex="-1">Role-Based Access Control (RBAC) for Chains</h4>
<div class="code-shell"><pre class="hljs"><code class="hljs language-python"><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Flag, auto

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChainPermission</span>(<span class="hljs-title class_ inherited__">Flag</span>):
    VIEW = auto()
    EXECUTE = auto()
    MODIFY = auto()
    DEPLOY = auto()
    DELETE = auto()
    VIEW_TRACES = auto()
    APPROVE_DEPLOYMENT = auto()

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChainACL</span>:
    chain_id: <span class="hljs-built_in">str</span>
    owner: <span class="hljs-built_in">str</span>
    role_permissions: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, ChainPermission]

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChainGovernance</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-variable language_">self</span>.acls: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, ChainACL] = {}
        <span class="hljs-variable language_">self</span>.deployment_approvers: <span class="hljs-built_in">set</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-built_in">set</span>()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">can_deploy</span>(<span class="hljs-params">self, chain_id: <span class="hljs-built_in">str</span>, user: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        acl = <span class="hljs-variable language_">self</span>.acls.get(chain_id)
        <span class="hljs-keyword">if</span> acl <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        user_perms = acl.role_permissions.get(user, ChainPermission(<span class="hljs-number">0</span>))
        <span class="hljs-keyword">return</span> ChainPermission.DEPLOY <span class="hljs-keyword">in</span> user_perms
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">request_deployment</span>(<span class="hljs-params">self, chain_id: <span class="hljs-built_in">str</span>, requester: <span class="hljs-built_in">str</span>,
                          chain_version: <span class="hljs-built_in">str</span>, test_results: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
        <span class="hljs-string">&quot;&quot;&quot;
        Deployment requires:
        1. All tests passing
        2. Safety evaluation passing
        3. Approval from designated approver
        &quot;&quot;&quot;</span>
        checks = {
            <span class="hljs-string">&quot;tests_passing&quot;</span>: test_results.get(<span class="hljs-string">&quot;all_passed&quot;</span>, <span class="hljs-literal">False</span>),
            <span class="hljs-string">&quot;safety_eval&quot;</span>: test_results.get(<span class="hljs-string">&quot;safety_score&quot;</span>, <span class="hljs-number">0</span>) &gt; <span class="hljs-number">0.95</span>,
            <span class="hljs-string">&quot;has_permission&quot;</span>: <span class="hljs-variable language_">self</span>.can_deploy(chain_id, requester),
            <span class="hljs-string">&quot;version_tagged&quot;</span>: chain_version <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>,
        }
        
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">all</span>(checks.values()):
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;approved&quot;</span>,
                <span class="hljs-string">&quot;deployment_id&quot;</span>: <span class="hljs-built_in">str</span>(uuid4()),
                <span class="hljs-string">&quot;approved_at&quot;</span>: datetime.utcnow().isoformat()
            }
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;rejected&quot;</span>,
                <span class="hljs-string">&quot;failed_checks&quot;</span>: [k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> checks.items() <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> v]
            }
</code></pre>
</div><h4 id="compliance-logging" tabindex="-1">Compliance Logging</h4>
<div class="code-shell"><pre class="hljs"><code class="hljs language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ComplianceLogger</span>:
    <span class="hljs-string">&quot;&quot;&quot;GDPR/HIPAA-aware chain execution logging.&quot;&quot;&quot;</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, log_store, retention_days: <span class="hljs-built_in">int</span> = <span class="hljs-number">90</span></span>):
        <span class="hljs-variable language_">self</span>.log_store = log_store
        <span class="hljs-variable language_">self</span>.retention_days = retention_days
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">log_execution</span>(<span class="hljs-params">self, trace_id: <span class="hljs-built_in">str</span>, chain_id: <span class="hljs-built_in">str</span>,
                      user_id: <span class="hljs-built_in">str</span>, input_data: <span class="hljs-built_in">dict</span>,
                      output_data: <span class="hljs-built_in">dict</span>, pii_detected: <span class="hljs-built_in">bool</span></span>):
        
        record = {
            <span class="hljs-string">&quot;trace_id&quot;</span>: trace_id,
            <span class="hljs-string">&quot;chain_id&quot;</span>: chain_id,
            <span class="hljs-string">&quot;user_id&quot;</span>: <span class="hljs-variable language_">self</span>._hash_user_id(user_id),  <span class="hljs-comment"># Pseudonymize</span>
            <span class="hljs-string">&quot;timestamp&quot;</span>: datetime.utcnow().isoformat(),
            <span class="hljs-string">&quot;input_hash&quot;</span>: hashlib.sha256(
                json.dumps(input_data, sort_keys=<span class="hljs-literal">True</span>).encode()
            ).hexdigest(),  <span class="hljs-comment"># Hash, don&#x27;t store raw input</span>
            <span class="hljs-string">&quot;output_length&quot;</span>: <span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>(output_data)),
            <span class="hljs-string">&quot;pii_detected&quot;</span>: pii_detected,
            <span class="hljs-string">&quot;retention_expiry&quot;</span>: (
                datetime.utcnow() + timedelta(days=<span class="hljs-variable language_">self</span>.retention_days)
            ).isoformat(),
            <span class="hljs-comment"># Do NOT log raw input/output for compliance</span>
            <span class="hljs-comment"># Log only metadata sufficient for audit</span>
        }
        
        <span class="hljs-variable language_">self</span>.log_store.write(record)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_deletion_request</span>(<span class="hljs-params">self, user_id: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">&quot;&quot;&quot;GDPR right to erasure — delete all traces for user.&quot;&quot;&quot;</span>
        hashed_id = <span class="hljs-variable language_">self</span>._hash_user_id(user_id)
        <span class="hljs-variable language_">self</span>.log_store.delete_by_user(hashed_id)
        <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;deleted&quot;</span>, <span class="hljs-string">&quot;user_hash&quot;</span>: hashed_id}
</code></pre>
</div>
      </article>
      <section class="doc-pager" aria-label="Document pagination">
        <a class="pager-link" href="../Agentic_ai/Routing_and_conditional_logic_in_chains.html"><small>Previous</small><strong>1.6 Routing and Conditional Logic in Chains</strong></a>
        <a class="pager-link" href="../Agentic_ai/State_management_and_context_propagation.html"><small>Next</small><strong>1.4 State Management and Context Propagation</strong></a>
      </section>
      <footer class="doc-footer">
        <p>Generated from <code>llm_training_at_scale</code> at <time datetime="2026-02-19T19:13:56.962Z">2026-02-19T19:13:56.962Z</time>.</p>
      </footer>
    </main>
    <aside class="toc-pane">
      <p class="pane-label">On This Page</p>
      <nav class="toc-nav" aria-label="Table of contents">
<a class="toc-link toc-level-2" data-toc-link href="#114-security-safety-and-guardrails-in-prompt-chains">1.14 Security, Safety, and Guardrails in Prompt Chains</a>
<a class="toc-link toc-level-3" data-toc-link href="#1141-threat-model-for-prompt-chains">1.14.1 Threat Model for Prompt Chains</a>
<a class="toc-link toc-level-4" data-toc-link href="#attack-surface-analysis">Attack Surface Analysis</a>
<a class="toc-link toc-level-4" data-toc-link href="#formal-threat-taxonomy">Formal Threat Taxonomy</a>
<a class="toc-link toc-level-3" data-toc-link href="#1142-defense-mechanisms">1.14.2 Defense Mechanisms</a>
<a class="toc-link toc-level-4" data-toc-link href="#input-sanitization-per-chain-step">Input Sanitization Per Chain Step</a>
<a class="toc-link toc-level-4" data-toc-link href="#guardrail-chain-pattern">Guardrail Chain Pattern</a>
<a class="toc-link toc-level-4" data-toc-link href="#canary-token-injection-detection">Canary Token Injection Detection</a>
<a class="toc-link toc-level-4" data-toc-link href="#principle-of-least-privilege-per-chain-step">Principle of Least Privilege Per Chain Step</a>
<a class="toc-link toc-level-3" data-toc-link href="#1143-safety-patterns">1.14.3 Safety Patterns</a>
<a class="toc-link toc-level-4" data-toc-link href="#architecture-defense-in-depth-for-chains">Architecture: Defense-in-Depth for Chains</a>
<a class="toc-link toc-level-4" data-toc-link href="#intermediate-safety-checkpoints">Intermediate Safety Checkpoints</a>
<a class="toc-link toc-level-3" data-toc-link href="#1144-access-control-and-governance">1.14.4 Access Control and Governance</a>
<a class="toc-link toc-level-4" data-toc-link href="#role-based-access-control-rbac-for-chains">Role-Based Access Control (RBAC) for Chains</a>
<a class="toc-link toc-level-4" data-toc-link href="#compliance-logging">Compliance Logging</a>
      </nav>
    </aside>
  </div>
  <script type="module" src="../assets/app.js?v=2026-02-19T19%3A13%3A56.962Z"></script>
</body>
</html>